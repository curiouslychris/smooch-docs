# Init
> Request:

```curl
curl https://api.smooch.io/v1/init \
     -X POST \
     -d '{"device": {"id": "03f70682b7f5b21536a3674f38b3e220", "platform": "ios", "appVersion": "1.0"}, "userId": "bob@example.com"}' \
     -H 'content-type: application/json' \
     -H 'authorization: Bearer your-jwt'
```

```js
smooch.appUsers.init({
    device: {
        id: '03f70682b7f5b21536a3674f38b3e220',
        platform: 'ios',
        appVersion: '1.0'
    },
    userId: 'bob@example.com'
}).then((response) => {
    // async code
});
```

> Response:

```
200 OK
```
```json
{
    "app": {
        "hasIcon": true,
        "apnEnabled": true,
        "gcmProject": "731399543244"
    },
    "appUser": {
        "_id": "c7f6e6d6c3a637261bd9656f",
        "userId": "bob@example.com",
        "properties": {},
        "signedUpAt": "2015-10-06T03:38:02.346Z",
        "clients": [
          {
            "active": true,
            "appVersion": "1.0",
            "id": "5A7F8343-DF41-46A8-96EC-8583FCB422FB",
            "lastSeen": "2016-03-09T19:09:01.431Z",
            "platform": "ios",
            "pushNotificationToken": "<...>",
            "info": {
              "appName": "ShellApp",
              "devicePlatform": "x86_64",
              "os": "iPhone OS",
              "osVersion": "9.2"
            }
          }
        ]
    }
}
```

<api>`POST /v1/init`</api>

This API is called by an iOS, Android, or browser client when the app is first loaded. It serves a number of purposes:

1. Initializes a new `appUser` and `client` if they don't yet exist
1. Updates an existing app user's profile and client information
1. Authenticates the `appUser` if `jwt` credentials are provided

The API requires that a `device` parameter be specified at the very minimum. A `userId` may also be specified to [link app user accounts across multiple clients](/guide/multi-client-users).

The API responds with an `appUser` object. The `appUser` includes an `_id` that can be used to make further API calls on behalf of that user. If the `userId` and/or `device.id` are seen for the first time a new `appUser` will be created. If not, the existing `appUser` be returned.

An `app` object is also returned which includes metadata about the app, such as information about push notification channels.

| **Arguments**               |   |
|-----------------------------|---|
| **device**<br/><span class='req'>required</span> | A descriptor of the user's device. See below. |
| **userId**<br/><span class='opt'>optional</span> | A unique identifier for the app user. Unlike the `smoochId` which is generated by Smooch, the `userId` is chosen by the API consumer. The `userId` can be used to link a user to the same conversation [across multiple clients](/guide/multi-client-users).|

<aside class="warning">
**Caution:** If you're specifying a `userId` then in order to keep conversations private we strongly suggest [authenticating your users](/#authenticating-users-optional). If a `userId` is used without a JWT credential, then anyone who can discover a user's `userId` could potentially eavesdrop on the conversation.
</aside>

## Devices are a type of client

Smooch uses the term `client` to refer generally to means by which a user can send and receive messages. This includes 3rd party accounts such as a connected Facebook Messenger account, however the init API specifically deals with registration and identification of iOS, Android and Web devices, which become persisted as one or many clients connected to a single user.

If a `userId` is used when calling `/v1/init`, then clients and app users may have a many-to-many relationship. A single `userId` may use Smooch from multiple clients and multiple different `userId`s may log in to the same device.

<aside class="notice">
**Note:** Only one `userId` can be active on a given client at a time. On a push notification capable client that's shared between multiple `userId`s, only the most recent `userId` to have called `/v1/init` will receive push notifications from the integrated application on that client.
</aside>

| **`device` arguments**      |   |
|-----------------------------|---|
| **id**<br/><span class='req'>required</span> | An identifier for the device. Must be globally unique. |
| **platform**<br/><span class='req'>required</span> | `ios`, `android`, `web`, or `other` |
| **pushNotificationToken**<br/><span class='opt'>optional</span> | The GCM or APN token to be used for sending push notifications to the device.
| **appVersion**<br/><span class='opt'>optional</span> | A reserved string field for reporting the app version running on the device. For example: `8.0` |
| **info**<br/><span class='opt'>optional</span> | A flat JSON structure detailing device properties. See below. |

## Device Info

The `device` object may also accept a flat `info` object. Device information reported here will be rendered alongside app user information inside any app maker channels configured with Smooch. The `platform` and `appVersion` fields are special in that they can be used as audience targeting criteria for whispers.

| Field                     | Example                   | Relevant Platforms |
|---------------------------|---------------------------|--------------------|
| **appName**               | `foo`                     | ios, android       |
| **deviceModel**           | `iPhone 5s`               | ios, android       |
| **os**                    | `iPhone OS`               | ios, android       |
| **osVersion**             | `8.1.2`                   | ios, android       |
| **radioAccessTechnology** | `HSDPA`                   | ios, android       |
| **carrier**               | `Acme`                    | ios, android       |
| **devicePlatform**        | `iPhone6,1`               | ios, android       |
| **wifi**                  | `YES`                     | ios, android       |
| **currentUrl**            | `http://mywebsite.com`    | web                |
| **userAgent**             | `Mozilla/5.0...`          | web                |
| **referrer**              | `http://google.com`       | web                |
| **browserLanguage**       | `en-US`                   | web                |
| **currentTittle**         | `Welcome`                 | web                |

The API will respond with the `_id` of the app user in question, which can then be used to make API calls to the conversation API. The response will also include any profile information that was previously set for the app user, including custom properties.

<aside class="notice">
In some scenarios, the `appUser._id` returned in an app boot call may change. This is possible for example when the `userId` is being used to log a user in on multiple clients, which may cause two distinct app users to merge together. The caller should always check if the returned `appUser._id` has changed, and re-fetch conversation history whenever appropriate.
</aside>